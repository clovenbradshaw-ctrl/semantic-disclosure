{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Airtable Export â€“ Client Summary Webhook Response",
  "description": "Schema for the n8n Client Summary webhook response containing Client Info, Case Master View, Applications, and Events records",
  "type": "array",
  "items": {
    "oneOf": [
      { "$ref": "#/definitions/clientInfoRecord" },
      { "$ref": "#/definitions/caseMasterViewRecord" },
      { "$ref": "#/definitions/applicationRecord" },
      { "$ref": "#/definitions/eventRecord" }
    ]
  },

  "definitions": {
    "valueOrError": {
      "description": "Wrapper for formula fields that may contain special values or errors",
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "specialValue": { "type": "string" }
          },
          "required": ["specialValue"],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "error": { "type": "string" }
          },
          "required": ["error"],
          "additionalProperties": false
        },
        { "type": "null" }
      ]
    },

    "linkObject": {
      "description": "Button/link field from Airtable",
      "type": "object",
      "properties": {
        "label": { "type": "string" },
        "url": { "type": "string", "format": "uri" }
      },
      "required": ["label", "url"],
      "additionalProperties": false
    },

    "personObject": {
      "description": "Collaborator/person field from Airtable",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "name": { "type": "string" }
      },
      "required": ["id", "email", "name"],
      "additionalProperties": false
    },

    "attachmentObject": {
      "description": "Attachment field from Airtable",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "url": { "type": "string", "format": "uri" },
        "filename": { "type": "string" },
        "size": { "type": "integer" },
        "type": { "type": "string" },
        "width": { "type": ["integer", "null"] },
        "height": { "type": ["integer", "null"] },
        "thumbnails": {
          "type": ["object", "null"],
          "properties": {
            "small": { "$ref": "#/definitions/thumbnailObject" },
            "large": { "$ref": "#/definitions/thumbnailObject" },
            "full": { "$ref": "#/definitions/thumbnailObject" }
          }
        }
      },
      "required": ["id", "url", "filename"]
    },

    "thumbnailObject": {
      "type": "object",
      "properties": {
        "url": { "type": "string", "format": "uri" },
        "width": { "type": "integer" },
        "height": { "type": "integer" }
      },
      "required": ["url", "width", "height"]
    },

    "dateTimeObject": {
      "description": "Google Calendar date/time object",
      "type": "object",
      "properties": {
        "dateTime": { "type": "string", "format": "date-time" },
        "date": { "type": "string", "format": "date" },
        "timeZone": { "type": "string" }
      },
      "additionalProperties": false
    },

    "attendeeObject": {
      "description": "Google Calendar event attendee",
      "type": "object",
      "properties": {
        "email": { "type": "string", "format": "email" },
        "displayName": { "type": ["string", "null"] },
        "responseStatus": {
          "type": "string",
          "enum": ["needsAction", "declined", "tentative", "accepted"]
        },
        "organizer": { "type": ["boolean", "null"] },
        "self": { "type": ["boolean", "null"] }
      },
      "required": ["email"]
    },

    "coreAirtableFields": {
      "description": "Fields present on all Airtable records",
      "type": "object",
      "properties": {
        "_sourceTable": { "type": "string" },
        "id": { "type": "string" },
        "createdTime": { "type": "string", "format": "date-time" }
      },
      "required": ["_sourceTable", "id"]
    },

    "clientInfoRecord": {
      "description": "Client Info table record",
      "allOf": [
        { "$ref": "#/definitions/coreAirtableFields" },
        {
          "type": "object",
          "properties": {
            "_sourceTable": { "const": "Client Info" },

            "Client Name": { "type": ["string", "null"] },
            "First Name": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "Family Name": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "Middle Name": { "type": ["string", "null"] },
            "Full Client Name": { "type": ["string", "null"] },
            "Family Name (Pretty)": { "type": ["string", "null"] },

            "A#": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "A_number_airtable": { "type": ["string", "null"] },

            "DOB": {
              "type": ["array", "null"],
              "items": { "type": "string", "format": "date" }
            },
            "Age": { "type": ["string", "integer", "null"] },

            "Country": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "Place of Entry": { "type": ["string", "null"] },
            "Entry Date": {
              "type": ["array", "null"],
              "items": { "type": "string", "format": "date" }
            },

            "Address": { "type": ["string", "null"] },
            "Phone Number": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "Client Email": { "type": ["string", "null"], "format": "email" },

            "Case Manager": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "ICH Atty": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "Custodian": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "PPID": { "type": ["string", "null"] },
            "PracticePanther": { "type": ["string", "null"] },
            "Link to Practice Panther": { "type": ["string", "null"] },

            "airtable_client_info_id": { "type": ["string", "null"] },
            "recordId": { "type": ["string", "null"] },
            "Case Master View Record ID": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "Case Master View // Activities": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "All Client Events": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "USCIS Applications": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "Case Tags Rollup (from Case Master View // Activities)": {
              "type": ["string", "null"]
            },
            "Hearing Type (from Case Master View // Activities)": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "Hearing Date/Time (from Case Master View // Activities)": {
              "type": ["array", "null"],
              "items": { "type": "string", "format": "date-time" }
            },
            "Closed File (from Case Master View // Activities)": {
              "type": ["array", "null"],
              "items": { "type": "boolean" }
            },
            "Matter_Flatpack (from Case Master View // Activities)": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "Client_Photo": {
              "type": ["array", "null"],
              "items": { "$ref": "#/definitions/attachmentObject" }
            },
            "Client Photo": {
              "type": ["array", "null"],
              "items": { "$ref": "#/definitions/attachmentObject" }
            },

            "box_shared_link": { "type": ["string", "null"] },
            "box link": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            },

            "SIJ Engagement Interviews": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "Box Sync Start": { "type": ["boolean", "null"] },
            "CMV sync": { "type": ["boolean", "null"] },

            "Created At": { "type": ["string", "null"] },
            "Airtable_Last_Modified": { "type": ["string", "null"], "format": "date-time" },

            "EAD Stage Ref": { "type": ["string", "null"] },
            "EAD ID Ref": { "type": ["string", "null"] },

            "Softr Client Page": { "type": ["string", "null"] },
            "Client Details Page": { "type": ["string", "null"] },
            "Kenect Link": { "type": ["string", "null"] },

            "bahr_import_flatpack_data": { "type": ["string", "null"] },
            "xanoEngagementNote": { "type": ["string", "null"] },

            "Events": { "type": ["string", "null"] },
            "Events 2": { "type": ["string", "null"] },
            "Matters": { "type": ["string", "null"] },

            "AMINO": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            },
            "Kenect Thread": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            }
          },
          "additionalProperties": true
        }
      ]
    },

    "caseMasterViewRecord": {
      "description": "Case Master View table record",
      "allOf": [
        { "$ref": "#/definitions/coreAirtableFields" },
        {
          "type": "object",
          "properties": {
            "_sourceTable": { "const": "Case Master View" },

            "Description": { "type": ["string", "null"] },
            "Case Notes": { "type": ["string", "null"] },

            "Relief Sought": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "Case Type": { "type": ["string", "null"] },
            "Case Tags": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "Hearing Date/Time": {
              "type": ["array", "null"],
              "items": { "type": "string", "format": "date-time" }
            },
            "Next Hearing": { "type": ["string", "null"], "format": "date-time" },
            "Court/Office": { "type": ["string", "null"] },
            "Judge": { "type": ["string", "null"] },

            "SIJ Case Status": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },
            "SIJ County": { "type": ["string", "null"] },
            "SIJ Eligible (child)": { "type": ["boolean", "null"] },

            "Closed File": { "type": ["boolean", "null"] },
            "Closed Box #": { "type": ["integer", "null"] },

            "Client_ID_Airtable": { "type": ["string", "null"] },
            "Client Info": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "Record ID": { "type": ["string", "null"] },
            "Case Master View Record ID": { "type": ["string", "null"] },

            "Matter_Flatpack": { "type": ["string", "null"] },

            "SIJ Visa Availability": { "$ref": "#/definitions/valueOrError" },
            "Appeal Engagement Deadline": { "$ref": "#/definitions/valueOrError" },
            "OYD ": { "$ref": "#/definitions/valueOrError" },
            "Days Elapsed since Engagement": { "$ref": "#/definitions/valueOrError" },
            "OYD Calculator": { "$ref": "#/definitions/valueOrError" },
            "Engagement vs Sent Out": { "$ref": "#/definitions/valueOrError" },
            "Mail vs Rcpt Date": { "$ref": "#/definitions/valueOrError" },
            "Est. Age at biometrics": { "$ref": "#/definitions/valueOrError" },
            "Mail vs Notice Date": { "$ref": "#/definitions/valueOrError" },
            "Sent vs Pending (EAD)": { "$ref": "#/definitions/valueOrError" },
            "Days to Next Hearing": { "$ref": "#/definitions/valueOrError" },

            "42b calc": { "type": ["string", "null"] },
            "Today Date": { "type": ["string", "null"], "format": "date-time" },

            "box link": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            },
            "Invoiced": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            },
            "FOIA Button": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            },
            "Atty Rec Req Button": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            },
            "Activity Details": {
              "anyOf": [
                { "$ref": "#/definitions/linkObject" },
                { "type": "null" }
              ]
            },

            "Last Modified By": {
              "anyOf": [
                { "$ref": "#/definitions/personObject" },
                { "type": "null" }
              ]
            },

            "Created At": { "type": ["string", "null"], "format": "date-time" },
            "Created Airtable Record": { "type": ["string", "null"], "format": "date-time" },
            "Created date": { "type": ["string", "null"], "format": "date-time" },

            "Update Tracker EADs": { "type": ["string", "null"], "format": "date-time" },
            "Update Tracker EAD Pers": {
              "anyOf": [
                { "$ref": "#/definitions/personObject" },
                { "type": "null" }
              ]
            },

            "Initial Retainer $": { "type": ["number", "null"] },
            "Total Contract $": { "type": ["number", "null"] }
          },
          "additionalProperties": true
        }
      ]
    },

    "applicationRecord": {
      "description": "Applications table record",
      "allOf": [
        { "$ref": "#/definitions/coreAirtableFields" },
        {
          "type": "object",
          "properties": {
            "_sourceTable": { "const": "Applications" },

            "Application Type": { "type": ["string", "null"] },
            "Current USCIS application": { "type": ["string", "null"] },

            "Status": { "type": ["string", "null"] },
            "Current Case Motion Status": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "USCIS (in Court)": { "type": ["boolean", "null"] },

            "Case Master": {
              "type": ["array", "null"],
              "items": { "type": "string" }
            },

            "Receipt Number": { "type": ["string", "null"] },
            "Priority Date": { "type": ["string", "null"], "format": "date" },
            "Filing Date": { "type": ["string", "null"], "format": "date" },
            "Approval Date": { "type": ["string", "null"], "format": "date" },
            "Expiration Date": { "type": ["string", "null"], "format": "date" },

            "Notes": { "type": ["string", "null"] },

            "EAD Category": { "type": ["string", "null"] },
            "EAD Stage": { "type": ["string", "null"] },

            "Biometrics Date": { "type": ["string", "null"], "format": "date" },
            "Biometrics Completed": { "type": ["boolean", "null"] },

            "Interview Date": { "type": ["string", "null"], "format": "date-time" },
            "Interview Location": { "type": ["string", "null"] },

            "Record ID": { "type": ["string", "null"] }
          },
          "additionalProperties": true
        }
      ]
    },

    "eventRecord": {
      "description": "Google Calendar event record",
      "type": "object",
      "properties": {
        "_sourceTable": { "const": "Events" },

        "id": { "type": "string" },
        "iCalUID": { "type": ["string", "null"] },
        "etag": { "type": ["string", "null"] },

        "summary": { "type": ["string", "null"] },
        "description": { "type": ["string", "null"] },
        "location": { "type": ["string", "null"] },

        "status": {
          "type": ["string", "null"],
          "enum": ["confirmed", "tentative", "cancelled", null]
        },

        "start": { "$ref": "#/definitions/dateTimeObject" },
        "end": { "$ref": "#/definitions/dateTimeObject" },

        "created": { "type": ["string", "null"], "format": "date-time" },
        "updated": { "type": ["string", "null"], "format": "date-time" },

        "creator": {
          "type": ["object", "null"],
          "properties": {
            "email": { "type": "string", "format": "email" },
            "displayName": { "type": ["string", "null"] },
            "self": { "type": ["boolean", "null"] }
          }
        },
        "organizer": {
          "type": ["object", "null"],
          "properties": {
            "email": { "type": "string", "format": "email" },
            "displayName": { "type": ["string", "null"] },
            "self": { "type": ["boolean", "null"] }
          }
        },

        "attendees": {
          "type": ["array", "null"],
          "items": { "$ref": "#/definitions/attendeeObject" }
        },

        "htmlLink": { "type": ["string", "null"], "format": "uri" },
        "hangoutLink": { "type": ["string", "null"], "format": "uri" },

        "recurringEventId": { "type": ["string", "null"] },
        "originalStartTime": { "$ref": "#/definitions/dateTimeObject" },

        "transparency": {
          "type": ["string", "null"],
          "enum": ["opaque", "transparent", null]
        },
        "visibility": {
          "type": ["string", "null"],
          "enum": ["default", "public", "private", "confidential", null]
        },

        "colorId": { "type": ["string", "null"] },

        "reminders": {
          "type": ["object", "null"],
          "properties": {
            "useDefault": { "type": "boolean" },
            "overrides": {
              "type": ["array", "null"],
              "items": {
                "type": "object",
                "properties": {
                  "method": { "type": "string", "enum": ["email", "popup"] },
                  "minutes": { "type": "integer" }
                }
              }
            }
          }
        },

        "conferenceData": { "type": ["object", "null"] },
        "attachments": { "type": ["array", "null"] },
        "extendedProperties": { "type": ["object", "null"] }
      },
      "required": ["_sourceTable", "id"],
      "additionalProperties": true
    }
  }
}
